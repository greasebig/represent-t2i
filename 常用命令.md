
# kill 显存   
sudo fuser -v /dev/nvidia*  
找到COMMAND=python的，然后通过以下命令逐一kill僵尸进程    
sudo kill -9 进程q

进程查看 ps -ef




# 终端上网

export https_proxy=http://0.0.0.0:7890 http_proxy=http://0.0.0.0:7890 all_proxy=socks5://0.0.0.0:7891

export https_proxy=http://0.0.0.0:7888 http_proxy=http://0.0.0.0:7888 all_proxy=socks5://0.0.0.0:7891


echo $http_proxy
echo $all_proxy

unset http_proxy    
unset https_proxy     
unset all_proxy

curl www.google.com


在当前目录下启动，输入下面命令即可启动服务     
./clash -d .     


./clash -d .  -f yml

之前的终端软件用不了，但是yml没问题    
换一个终端软件使用 不行    
也有可能要更新yml 不行

可能换一个端口也可以.不太好换           
这才是最有效的     
7888

export http_proxy=127.0.0.1:7890
export https_proxy=127.0.0.1:7890

export http_proxy="http://127.0.0.1:7890"
export https_proxy="http://127.0.0.1:7890"






curl www.baidu.com




新机器有时报错     
ImportError:   
Using SOCKS proxy, but the 'socksio' package is not installed. Make sure to install httpx using `pip install httpx[socks]`.    
pip install httpx[socks]    





# 本地上网

192.168.1.233

1081


# 软连接
ln -s 源文件 目标文件

hug上下载的权重有软连接，直接mv很多移动不了   

ln -s [目标] [链接名称]

解释   
目标：你想要链接到的文件或目录。   
链接名称：你要创建的符号链接的名称。



示例    
假设你有一个文件 file.txt，你想创建一个名为 link_to_file.txt 的符号链接。


    ln -s file.txt link_to_file.txt
执行这个命令后：

link_to_file.txt 将成为一个指向 file.txt 的符号链接。
对 link_to_file.txt 的任何操作实际上都会作用在 file.txt 上。




## 报错 ln: failed to create symbolic link 'potrace': Function not implemented


可能的原因

    文件系统限制：某些文件系统（如 FAT32 或 NTFS）在某些操作系统（如某些 Linux 发行版）上不支持符号链接。
    操作系统限制：某些操作系统（例如某些嵌入式系统或特殊配置的系统）不支持符号链接。
    权限问题：缺少创建符号链接的权限。



文件系统类型为 overlay 表示你可能在使用 Docker、Kubernetes 或其他基于容器的环境，这种环境中默认使用 overlayfs 作为文件系统。overlayfs 文件系统确实可能不支持符号链接或具有一些限制。



1. 在宿主机上创建符号链接    
如果你有对宿主机的访问权限，可以在宿主机上创建符号链接，然后将该链接挂载到容器中。

例如：


    # 在宿主机上创建符号链接
    sudo ln -s /path/to/target /path/to/link_name

    # 将符号链接挂载到容器中
    docker run -v /path/to/link_name:/path/in/container some-docker-image


2. 使用硬链接    
如果目标是一个文件而不是目录，可以尝试使用硬链接（但注意硬链接不能跨文件系统边界，并且不能用于目录）。


ln /path/to/target /path/to/link_name

3. 修改容器文件系统   
如果你有权限，可以尝试修改容器的文件系统设置，使其支持符号链接。

4. 直接使用路径   
在一些情况下，可以避免使用符号链接，而是直接使用目标文件的路径。例如，直接引用 /path/to/target 而不是 /path/to/link_name。

5. 使用配置管理工具 
如果你在使用容器编排工具（如 Kubernetes），可以使用 ConfigMap 或 Secret 将配置文件注入到容器中，而不依赖于符号链接。

6. 检查并配置 overlayfs 
有时可以通过调整 overlayfs 的配置来支持符号链接，但这通常需要系统管理员的权限和深入的系统配置知识。

切换到支持符号链接的文件系统：

如果当前文件系统不支持符号链接，考虑将目标文件或目录移动到支持符号链接的文件系统（如 ext4 或 btrfs）。

如果文件系统类型是不支持符号链接的（如 vfat），考虑使用支持符号链接的文件系统（如 ext4）。


如果操作系统或内核本身不支持符号链接，考虑更新到支持符号链接的版本。


## ln: failed to create hard link 'potrace' => '/usr/bin/potrace': Invalid cross-device link

这个错误信息表明你尝试创建的硬链接跨越了不同的文件系统（设备），这是不被允许的。硬链接只能在同一个文件系统内创建。如果你必须在不同的文件系统之间创建链接，可以考虑以下解决方案：


2. 使用软链接替代方法    
如果由于某些原因无法使用符号链接，可以通过创建脚本来模拟符号链接的行为。例如，在需要使用符号链接的位置创建一个脚本，这个脚本调用实际的文件：

创建一个脚本：


    echo -e '#!/bin/sh\nexec /usr/bin/potrace "$@"' > /path/to/link/potrace
    chmod +x /path/to/link/potrace
使用这个脚本：     
确保调用 /path/to/link/potrace 的地方使用这个脚本。


## 解决大法： 直接cp可执行文件/usr/bin/potr
ace


## 软连接和硬连接有什么区别

总结    
软连接：更灵活，可以跨文件系统和指向目录，适用于快捷方式等用途。     
硬连接：更可靠，适用于需要多次引用同一文件的数据保护等用途，但受限于同一文件系统内且不能指向目录。     

更新和删除：

`如果目标文件被删除，软连接会变成一个悬挂的（dangling）链接，指向一个不存在的文件。`       
`删除软连接不会影响目标文件。`


硬连接是文件系统中一个指向文件数据的目录项。它们共享相同的 inode 号码。

不能指向目录（在大多数文件系统中）。     
更新和删除：

`如果目标文件被删除，只要还有硬连接指向它，文件数据不会被删除，只有当最后一个硬连接被删除时，文件数据才会被删除。`     
类似torch清除变量机制    
`硬连接与目标文件是等价的，删除任何一个连接都是删除一个目录项，不会影响数据的存在。`     
常用于备份、恢复文件等。    



inode（索引节点）是文件系统中存储文件和目录元数据的数据结构。每个文件和目录都有一个唯一的 inode，它包含除了文件名和实际数据之外的所有信息。

inode 包含的信息   

    文件类型：

    普通文件、目录、符号链接、设备文件等。
    权限和模式：

    文件的读、写、执行权限（所有者、组、其他人的权限）。
    文件的类型和模式（例如，文件、目录、符号链接等）。
    所有者信息：

    文件所有者的用户 ID（UID）。
    文件所属组的组 ID（GID）。
    时间戳：

    文件的创建时间、最后访问时间、最后修改时间和元数据更改时间。
    链接计数：

    指向此 inode 的目录项数量，表明有多少个硬链接指向该文件。
    文件大小：

    文件的字节大小。
    数据块指针：

    指向存储文件数据的实际磁盘块的指针。这些指针将文件数据与 inode 连接起来。


字典     














# scp传文件
scp -r -P 32483 root@61.170.32.3:/models/playground-v2.5-1024px-aesthetic ./     
注意端口要大写P   
异于ssh   

而且-P 32483 `只能放在前面`，中间结尾都不行， 即使服务器放在后面，被传输
   

# wget
wget -q -c http -O NAME     

-q选项表示"quiet"，即安静模式，它会减少输出，只显示关键信息，不显示冗长的进度条和其他信息。    
-c选项表示"continue"，即继续下载。如果下载中断了，使用这个选项可以继续下载而不是重新开始。     



# mac
## macbook截图
Shift、Command和4键

录屏   
Shift、Command和5键    

## 切换桌面
【Ctrl】键加上【左右方向键  

【Ctrl】键加上【上下方向键 ：整体桌面管理和排序 

# win11

## win11截图
win shift s

## win todesk控制macOS
ctrl shift shift 换屏幕     
caps切换中英文      
home 方向键 切换桌面        
ctrl + 放大       


## 桌面切换
【Windows徽标键】+【Ctrl】键加上【左右方向键     
【Windows徽标键】+【Ctrl】+【D】可以新建一个虚拟桌面    
[Win + Tab]()可以调出任务界面------可以用以从后到前返回           


容易误触成 win+左右方向键    
win + 上 ：全屏      
win + 下 ：最小化    
win + 左 ：放到左半边           




切换窗口快捷键    
WIN+数字。。没有桌面切换方便        





# civitai终端下载
wget https://civitai.com/api/download/models/444122?token=token -O SDXL真实感大模型realistic.safetensors

wget "https://civitai.com/api/download/models/455150?type=Model&format=SafeTensor&size=full&fp=fp32&token=token" -O SDXL真实感大模型realistic.safetensors

没问号用？    
有问号用&，加双引号   

有时会有这个问题   
Unable to establish SSL connection.     
重新启动代理即可，刷新更换     



# find
find /home/WujieAITeam/private -type d -name "stable-diffusion-xl-base-1.0"

find /home/WujieAITeam/private -name "mjhq30k_imgs.zip"


# 环境变量声明
set CUDA_VISIBLE_DEVICES=1     

export OPENAI_LOGDIR=./logs_inpaint/

CUDA_VISIBLE_DEVICES=1 python script.py

import os     
os.environ["CUDA_VISIBLE_DEVICES"] = "5"


# 终端查找历史命令

使用 Ctrl + R 进行反向搜索：
您可以按下 Ctrl + R 键，然后开始输入部分命令。终端会自动显示最接近的匹配项。继续按 Ctrl + R 将继续在历史记录中搜索更早的命令。




# requirements,txt写法
    contexttimer
    decord
    diffusers<=0.16.0
    einops>=0.4.1
    fairscale==0.4.4

# pip
## pip升级
pip install transformers --upgrade
## pip不使用本地缓存安装指定库
pip --no-cache-dir install  包名 -i  国内源
## pip源
--index-url  
-i   
pip install --extra-index-url https://pypi.mirrors.ustc.edu.cn/simple/       
--extra-index-url    



Looking in indexes: https://pypi.org/simple, https://pypi.mirrors.ustc.edu.cn/simple/    

export PIP_INDEX_URL=https://pypi.tuna.tsinghua.edu.cn/simple 

    清华：https://pypi.tuna.tsinghua.edu.cn/simple
    阿里云：http://mirrors.aliyun.com/pypi/simple/
    中国科技大学 https://pypi.mirrors.ustc.edu.cn/simple/
    华中理工大学：http://pypi.hustunique.com/
    山东理工大学：http://pypi.sdutlinux.org/
    豆瓣：http://pypi.douban.com/simple/


pip中科大源     
pip install torch -i https://pypi.mirrors.ustc.edu.cn/simple/    

https://mirrors.cloud.tencent.com

## 国外源
 https://pypi.org/


# tmux
tmux kill-session -t edm2  
tmux attach -t edm2   
tmux new-session -s edm2   


# 镜像hug下载

export HF_ENDPOINT=https://hf-mirror.com

huggingface-cli download --repo-type dataset --resume-download playgroundai/MJHQ-30K --local-dir playgroundai/MJHQ-30K

huggingface-cli download --resume-download gpt2 --local-dir gpt2


## 单文件
wget https://hf-mirror.com/runwayml/stable-diffusion-v1-5/resolve/main/v1-5-pruned-emaonly.safetensors?download=true

这样一般下载得，需要重命名 'yoso_lora.safetensors?download=true'

而不是  
wget https://hf-mirror.com/runwayml/stable-diffusion-v1-5/blob/main/v1-5-pruned-emaonly.safetensors




# 删除设置的环境变量

unset HF_ENDPOINT   
echo $HF_ENDPOINT    





# linux zip压缩命令
压缩指定文件到目标压缩文件：

zip target.zip file1 file2 file3

这种方法适用于压缩指定的几个文件到一个新的目标压缩文件中。

压缩指定目录及其子目录下的所有文件到目标压缩文件：

zip -r target.zip folder



# Linux统计文件夹下的文件数目
统计当前目录下文件的个数（不包括目录）  
ls -l | grep "^-" | wc -l   
统计当前目录下文件的个数（包括子目录）   
ls -lR| grep "^-" | wc -l   
查看某目录下文件夹(目录)的个数（包括子目录）  
ls -lR | grep "^d" | wc -l   

ls -l   
长列表输出该目录下文件信息(注意这里的文件是指目录、链接、设备文件等)，每一行对应一个文件或目录，ls -lR是列出所有文件，包括子目录。

grep "^-"   
过滤ls的输出信息，只保留一般文件，只保留目录是grep "^d"。

wc -l   
统计输出信息的行数，统计结果就是输出信息的行数，一行信息对应一个文件，所以就是文件的个数。





# 远程服务器vscode debug
必须先在服务器上装python和python debugger扩展   
没有就是vscode版本太久，某些方面不兼容了    



# diffusers转ckpt safetensors
python scripts/convert_diffusers_to_original_stable_diffusion.py --model_path model_dir --checkpoint_path path_to_ckpt.ckpt




# github镜像
github在国内会碰到下载不稳定的情况，推荐使用镜像

https://bgithub.xyz/
将前缀更换即可，例如：

https://github.com/OpenGVLab/CaFo
https://bgithub.xyz/OpenGVLab/CaFo



# conda本机复制环境 删除

conda create --name <new_environment_name> --clone <existing_environment_name>

conda remove --name <environment_name> --all

# conda跨机环境
同一区硬盘    
conda install -c conda-forge conda-pack    

conda pack -n <envsname> -o conda_envsname.tar.gz

mkdir -p /root/anaconda3/envs/<envsname>    

tar -xzf /root/tempfile/conda_envsname.tar.gz -C /root/miniconda3/envs/<envsname>  


tar -xzf /root/tempfile/conda_envsname.tar.gz -C /root/anaconda3/envs/<envsname>    

常见错误：   
conda装torch，又使用pip装新版本    

    CondaPackError: 
    Files managed by conda were found to have been deleted/overwritten in the
    following packages:

    - pytorch 1.13.1:
        lib/python3.10/site-packages/torch-1.13.1-py3.10.egg-info/PKG-INFO
        lib/python3.10/site-packages/torch-1.13.1-py3.10.egg-info/SOURCES.txt
        lib/python3.10/site-packages/torch-1.13.1-py3.10.egg-info/dependency_links.txt
        + 3 others
    - torchvision 0.14.1:
        lib/python3.10/site-packages/torchvision-0.14.1-py3.10.egg-info/PKG-INFO
        lib/python3.10/site-packages/torchvision-0.14.1-py3.10.egg-info/SOURCES.txt
        lib/python3.10/site-packages/torchvision-0.14.1-py3.10.egg-info/dependency_links.txt
        + 4 others

    This is usually due to `pip` uninstalling or clobbering conda managed files,
    resulting in an inconsistent environment. Please check your environment for
    conda/pip conflicts using `conda list`, and fix the environment by ensuring
    only one version of each package is installed (conda preferred).

CondaPackError: Cannot pack an environment with editable packages

    installed (e.g. from `python setup.py develop` or
    `pip install -e`). Editable packages found:

    - /data/lujunda/sd/glid-3-xl-stable-master
    - /data/lujunda/sd/glid-3-xl-stable-master/latent-diffusion
    - /data/lujunda/sd/glid-3-xl-stable-master/latent-diffusion/src/clip
    - /data/lujunda/sd/glid-3-xl-stable-master/latent-diffusion/src/taming-transformers
conda pack -n <envsname> -o conda_envsname.tar.gz --ignore-editable-packages


# 服务器网页映射本地
端口转发？    

ssh -L [本地端口]:[远程地址]:[远程端口] [用户]@[服务器地址   
例如：ssh -L 8080:127.0.0.1:80  user@example.co    

不设置本地地址就默认是 127.0.0.1    
或者 http://localhost:8080   


ssh -L 8080:0.0.0.0:11223 root@hz-t3.matpool.com    
ssh -L 8080:0.0.0.0:11223 root@hz-t3.matpool.com -p 29705   
直接就登录了     
macbook还是比较不一样的，既能登录又能映射     



vscode自己就帮忙映射本地，但是有时会有问题，网页加载不出      
可能是主机代理原因？     
还得用网页jupyter+本地terminal      
主机代理还导致给飞书上传不了大图片   








# huggingface登录下载
huggingface-cli login   

https://huggingface.co/settings/tokens


# 装git lfs
curl -s https://packagecloud.io/install/repositories/github/git-lfs/script.deb.sh | sudo bash    
sudo apt-get install git-lfs     




# torch将变量从cpu转到cuda，相同浮点数
noise = noise.to('cuda')

mat1 and mat2 must have the same dtype
tensor = torch.randn(3, 3)
tensor_float16 = tensor.to(torch.float16)



# vim退出保存
:wq   
:q   
:q!   


vim删除所有   
esc.不要进入：     
使用 ggdG 命令。这个命令的含义是：   
gg 将光标移动到文件的开头。   
dG 删除从当前光标位置到文件末尾的所有内容。   







这些源都不如外网几十mb快   

# 查看机器型号下载cuda
uname -m   
arch   
lsb_release -a   



# 手装xformers
用它的自动脚本又慢又久     
简直愚蠢    

torch2.1.2+cu118      
pip install xformers==0.0.22.post4 --index-url https://download.pytorch.org/whl/cu118    
Collecting torch==2.1.0 (from xformers==0.0.22.post4)    

3090 2号    
xformers                          0.0.20     
torch                             2.0.1+cu118    
`正常使用`   


3090 1号原镜像    
torch                             1.13.1+cu117   
xformers                          0.0.16rc425    

3090 1号    
torch2.1.2+cu118  py311   
pip install xformers==0.0.23.post1 --index-url https://download.pytorch.org/whl/cu118       
没有冲突   
`正常使用`   

3机    
pip install xformers==0.0.23.post1 --index-url https://download.pytorch.org/whl/cu121  

    model_base.py 6 <module>
    from ldm_patched.ldm.modules.diffusionmodules.openaimodel import UNetModel, Timestep


    openaimodel.py 22 <module>
    from ..attention import SpatialTransformer, SpatialVideoTransformer, default

    attention.py 21 <module>
    import xformers

    ModuleNotFoundError:
    import of xformers halted; None in sys.modules


重装torch 2.1.2cu118   
还是这个错误    

python launch.py --xformers    
原因在于启动命令




# 结尾




